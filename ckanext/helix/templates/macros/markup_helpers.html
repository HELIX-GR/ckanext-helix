
{%- macro mark_required(required, msg=None) -%}
   {%- if required -%}
   <span title="{{ msg or _("This field is required") }}" class="control-required">*</span>
   {%- endif -%}
{%- endmacro -%}

{# Make titles readable #}

{%- macro map_titles(titles, key, dtype='datacite') -%}  
    {% set title =  titles.get(key, key|title) %}
    {%if title == 'Owner_org' %}
        {{_('Institution')}}
    {%elif title == 'Notes' %}
        {{_('Description (English)')}}   
    {%elif title == dtype + '('"'.title'"',)' %}
        Title
    {% elif title == '('"'datacite.creator_first_name'"',)' %}
        {{_('Creator (first name)')}}   
    {% elif title == '('"'datacite.creator_last_name'"',)' %}
        {{_('Creator (last name)')}}      
    {% elif title == dtype|capitalize + '.related_publication' %}
        {{_('Related publication')}}
    {% elif title == dtype|capitalize + '.is_derived_from' %}
        {{_('Derived from')}}
    {% elif title == dtype|capitalize + '.is_similar_to' %}
        {{_('Similar to')}}
    {% elif title == dtype|capitalize + '.publication_year' %}
        {{_('Publication year')}}
    {% elif title == '('"'datacite.contact_email'"',)' %}
        {{_('Contact Email')}}
    {% elif title == 'Closed_tag' %}
        {{_('Subject')}}
    {% else %}
        {{title}}
    {% endif%}    
    {%- endmacro -%}   
 
    {%- macro map_messages(message) -%}  
    {% if message == 'Invalid (InvalidDoi)' %}
        {{_('Invalid DOI value')}}
    {% elif message == 'Invalid (InvalidYear)' %}
        {{_('Invalid year')}}
    {% else %}
        {{message}}
    {% endif%}    
    {%- endmacro -%}        

{%- macro message_list(messages, key=None, titles={}, dtype='datacite') -%}
    {% if messages -%} 
    {% if key %}<h4 data-key="{{ key }}" class="title">{{ map_titles(titles, key, dtype) }}</h4>{% endif %}
    {% if messages is string %}
    <span>{{ messages }}</span>
    {% elif messages is mapping -%}
    <ul>
        {% for k in messages -%}<li>{{ message_list(messages[k], k, titles, dtype) }}</li>{% endfor -%}
    </ul>
    {% elif messages is sequence -%}
    {% with n = messages|count %}
    {% if n <= 1 %}
    <span>{{ map_messages(messages|first) }}</span>
    {% else %}
    <ul>
        {% for msg in messages -%}<li>{{ map_messages(msg) }}</li>{% endfor -%}
    </ul>
    {% endif -%} {# if n #} 
    {% endwith %} {# with n #}
    {% endif -%} {# if mapping #}
    {% endif -%} {# if messages #}
{%- endmacro -%}

{% macro error_messages(errors, dtype='datacite',  summary=None, titles={}) -%}
    {% if errors or summary -%} 
    <div class="alert alert-danger errors error-messages">
        {% if summary %}<h3>{{ summary|safe }}</h3>{% endif %}
        {% if errors %}{{ message_list(errors, key=None, titles=titles, dtype=dtype) }}{% endif %}
    </div>
    {% endif -%}
{% endmacro -%}

